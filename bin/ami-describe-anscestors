#!/usr/bin/env python

from amitools import clsetup
clsetup()

def get_args():
    import argparse
    parser = argparse.ArgumentParser(
        description='',
        epilog='',
        formatter_class=argparse.RawDescriptionHelpFormatter,
        )
    parser.add_argument('image_id',
                        help='ID of AMI to find anscestry of')
    return parser.parse_args()

if '__main__' == __name__:
    from amitools import (
        ec2connect,
        build_chain,
        )
    args = get_args()
    conn = ec2connect()
    all_images = conn.get_all_images(filters={'tag-key':'source_image'})
    try:
        chain = build_chain(args.image_id, all_images)
    except AssertionError:
        import sys
        sys.stderr.write('Cannot locate image {} - aborting\n'.format(args.image_id))
        sys.exit(1)
    for image_id in chain:
        print(image_id)
        
